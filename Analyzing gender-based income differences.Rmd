---
title: "Analyzing gender-based income differences using NLSY79"
author: "Aiswariya Raja"
date: "4/26/2021"
output:
  pdf_document: default
  html_document: default
---


###Project Outline:
As a part of this project, I'm trying to address the following question:

#####Is there a significant difference in income between men and women? If yes, what are some factors contributing to this difference?

This project uses the NLSY79 (National Longitudinal Survey of Youth, 1979 cohort) data set. The NLSY79 data set contains survey responses of individuals who were interviewed first in 1979. They were also subsequently interviewed every one or two years after that up until 2012. 

This project primarily consists of the following 4 sections:

1. Data Summary
2. Methodology
3. Findings
4. Discussion

                                                  *************************************

```{r, echo = FALSE, message = FALSE, warning = FALSE}
#Loading all required library packages 
library(plyr)
library(dplyr)
library (knitr)
library(ggplot2)
library(MASS)
library(wesanderson)
library(kableExtra)
```
`



```{r, echo = FALSE, message = FALSE, warning = FALSE}
#Importing Data for Final Project
nlsy <- read.csv("http://www.andrew.cmu.edu/user/achoulde/94842/final_project/nlsy79/nlsy79_income.csv", header=TRUE)
```


```{r, echo = FALSE, message = FALSE, warning = FALSE}
#Renaming columns with more meaningful names
colnames(nlsy) <- c("VERSION_R25_2012",
    "CASEID_1979","cob","south",
    "FAM-3_1979","foreign.lang","FAM-RES_1979","FAM-6_1979","R_REL-1_COL_1979","SCHOOL-31_1979",
    "MIL-6_1979","WOMENS-ROLES_000001_1979","WOMENS-ROLES_000002_1979","WOMENS-ROLES_000003_1979",
    "WOMENS-ROLES_000004_1979","WOMENS-ROLES_000006_1979","WOMENS-ROLES_000007_1979",
    "WOMENS-ROLES_000008_1979","EXP-OCC_1979","EXP-9_1979","race","gender","marital.status",
    "famsize.1979","POVSTATUS_1979","POLICE-1_1980","POLIC-1C_1980","POLICE-2_1980","ALCH-2_1983",
    "drug.use","DS-9_1984","Q13-5_TRUNC_REVISED_1990","POVSTATUS_1990","HGCREV90_1990","jobs.num",
    "NUMCH90_1990","AGEYCH90_1990","DS-12_1998","DS-13_1998","INDAL-EMP.01_2000",
    "CPSOCC80.01_2000","OCCSP-55I_CODE_2000","Q2-15B_2000","Q10-2_2000",
    "Q13-5_TRUNC_REVISED_2000","FAMSIZE_2000","TNFI_TRUNC_2000","POVSTATUS_2000",
    "MARSTAT-COL_2000","MARSTAT-KEY_2000","MO1M1B_XRND","Q2-10B~Y_2012","industry",
    "OCCALL-EMP.01_2012","OCCSP-55I_CODE_2012","Q2-15A_2012","Q12-6_2012","income",
    "Q13-5_SR000001_2012","Q13-5_SR000002_2012","Q13-18_TRUNC_2012",
    "Q13-18_SR000001_TRUNC_2012","famsize.2012","REGION_2012","HGC_2012","URBAN-RURAL_2012","JOBSNUM_2012")
nlsy.2 <- nlsy
```


```{r, echo = FALSE, message = FALSE, warning = FALSE}
#Recoding values of choice to have appropriate names 

nlsy.2 <- transform(nlsy.2, gender = as.factor(mapvalues(gender, c(1,2), c("Male","Female"))),
                    south = as.factor(mapvalues(south, c(-4,-3,-2,0,1), c("Other",NA,NA,"Not South", "South"))),
                    race =  as.factor(mapvalues(race, c(1,2,3), c("Hispanic", "Black", "NBNH"))),
                    marital.status = as.factor(mapvalues(marital.status, c(-3,0,1,2,3,5,6), 
                                                        c(NA,"Never Married", "Married", "Seperated",
                                                          "Divorced","Remarried","Widowed"))),
                    foreign.lang = as.factor(mapvalues(foreign.lang, c(-4,-3,-2,1,2,3,4), 
                                                        c("None",NA,NA, "Spanish", "French",
                                                          "German","Other"))),
                    drug.use =  as.factor(mapvalues(drug.use, c(-5,-3,-1,0,1,2,3,4,5), 
                                                  c(NA,NA,NA, "Never Used", "1-9 occasions", 
                                                    "10-39 occasions","40-99 occasions", 
                                                    "100-999 occasions","1000+ occasions"))),
                    cob = as.factor(mapvalues(cob, c(-3,1,2), c(NA, "US", "Other"))))

```


```{r, echo = FALSE, message = FALSE, warning = FALSE}
#Cleaning Dependent Variable: Income(2012)

#Mapping all missing values to NA while retaining topcoded values
nlsy.2$income[nlsy.2$income == -5] <- NA
nlsy.2$income[nlsy.2$income == -4] <- NA
nlsy.2$income[nlsy.2$income == -3] <- NA
nlsy.2$income[nlsy.2$income == -2] <- NA
nlsy.2$income[nlsy.2$income == -1] <- NA
nlsy.2$income[nlsy.2$income == 0] <- NA


#Creating a new income variable with missing values mapped to NA but topcoded values removed
nlsy.2$income.clean <- nlsy.2$income
nlsy.2$income.clean[nlsy.2$income.clean == 343830] <- NA



#Recoding industry values to meaningful names
nlsy.2$industry[nlsy.2$industry >= 170 & nlsy.2$industry <= 290] <- "Agri Forest Fish"
nlsy.2$industry[nlsy.2$industry >= 370 & nlsy.2$industry <= 490] <- "Mining"
nlsy.2$industry[nlsy.2$industry >= 570 & nlsy.2$industry <= 690] <- "Utilities"
nlsy.2$industry[nlsy.2$industry ==770] <- "Construction"
nlsy.2$industry[nlsy.2$industry >= 1070 & nlsy.2$industry <= 3990] <- "Manufacturing"
nlsy.2$industry[nlsy.2$industry >= 4070 & nlsy.2$industry <= 4590] <- "Wholesale Trade"
nlsy.2$industry[nlsy.2$industry >= 4670 & nlsy.2$industry <= 5790] <- "Retail Trade"
nlsy.2$industry[nlsy.2$industry >= 6070 & nlsy.2$industry <= 6390] <- "Trans Warehousing"
nlsy.2$industry[nlsy.2$industry >= 6470 & nlsy.2$industry <= 6780] <- "Information"
nlsy.2$industry[nlsy.2$industry >= 6870 & nlsy.2$industry <= 6990] <- "Finance Insurance"
nlsy.2$industry[nlsy.2$industry >= 7070 & nlsy.2$industry <= 7190] <- "Real Estate"
nlsy.2$industry[nlsy.2$industry >= 7270 & nlsy.2$industry <= 7490] <- "Prof Sci Tech Services"
nlsy.2$industry[nlsy.2$industry >= 7570 & nlsy.2$industry <= 7790] <- "Manage Admin Services"
nlsy.2$industry[nlsy.2$industry >= 7860 & nlsy.2$industry <= 7890] <- "Education Services"
nlsy.2$industry[nlsy.2$industry >= 7970 & nlsy.2$industry <= 8470] <- "Health Care"
nlsy.2$industry[nlsy.2$industry >= 8560 & nlsy.2$industry <= 8590] <- "Arts Entertainment"
nlsy.2$industry[nlsy.2$industry >= 8660 & nlsy.2$industry <= 8690] <- "Accomodations & Food"
nlsy.2$industry[nlsy.2$industry >= 8770 & nlsy.2$industry <= 9290] <- "Except Public Administration"
nlsy.2$industry[nlsy.2$industry >= 9370 & nlsy.2$industry <= 9870] <- "Active Military"
nlsy.2$industry[nlsy.2$industry ==9890] <- "Armed Forces"
nlsy.2$industry[nlsy.2$industry == 9950] <- NA
nlsy.2$industry[nlsy.2$industry == 9990] <- "Uncodeable"
nlsy.2$industry[nlsy.2$industry == -4] <- "Other"
nlsy.2$industry[nlsy.2$industry == -5] <- NA

#Converting industry to factor format
nlsy.2$industry <- as.factor(nlsy.2$industry)
```


```{r, echo = FALSE, message = FALSE, warning = FALSE}
#Reordering factor levels to choose an appropriate baseline

nlsy.2$race <- factor(nlsy.2$race, levels = c("Black","Hispanic","NBNH"))
nlsy.2$gender <- factor (nlsy.2$gender, levels = c("Female","Male"))
nlsy.2$marital.status <- factor(nlsy.2$marital.status, levels = c("Never Married", "Married", "Divorced", "Seperated", "Widowed"))
nlsy.2$south <- factor(nlsy.2$south, levels = c("Not South","South", "Other"))
nlsy.2$drug.use <- factor(nlsy.2$drug.use, levels = c("Never Used", "1-9 occasions", "10-39 occasions","40-99 occasions",
                                                      "100-999 occasions","1000+ occasions"))
nlsy.2$foreign.lang <- factor(nlsy.2$foreign.lang, levels = c("None","Spanish","French","German", "Other"))
```


```{r, echo = FALSE, message = FALSE, warning = FALSE}
#Super Important Part: Subsetting data to only include individuals born in the US
nlsy.1 <- nlsy.2[nlsy.2$cob=="US", ]
```



##1. Data Summary:
As a part of the NLSY79 survey, **`r nrow(nlsy.2)`** individuals were interviewed and responses were collected on a variety of factors such as Country of Birth, Family Size, Marital Status, Income etc. For the purpose of my analysis, I've subsetted the data to only include individuals born in the United States. This brings my total number of respondents to **`r nrow(nlsy.1)`**.

To analyse this problem of gender-based income difference, I chose the following variables:

a. **Income:** Total income of the respondent from waged and salary in the past calendar year as reported in 2012
b. **Gender:** The sex of the respondent as reported in 1979
c. **Race:** The respondent's racial/ethnic cohort as reported in 1979
d. **Marital Status:** The respondent's marital status as reported in 1979
e. **Family Size:**The respondent's family size as reported in 1979
f. **Place of Birth:** The respondent's place of birth in the US (South/Not South) as reported in 1979
g. **Drug Use:** The number of times that the respondent has used Marijuana in his/her lifetime as reported in 1984
h. **Foreign Language:** Foreign language that was spoken at home during respondent's childhood as reported in 1979


*Note:* For most parts of this project, I have used income without top-coded values. The rationale for this choice and how top-coded values were dealt with will be explained as we progress further. 

Since the problem is based on gender differences, let's start by looking at the number of male and female respondents in our subset. 

#####Table 1: Number of respondents broken down by gender category
```{r, echo = FALSE, message = FALSE, warning = FALSE}
#Summary table for number of respondents broken down by Gender 
sex.summary <- table(nlsy.1$gender)
sex.summary
```

From the above table we can see that, female respondents make up `r round((sex.summary[1]/(sex.summary[1]+sex.summary[2])),4)*100`% and male respondents make up `r round((sex.summary[2]/(sex.summary[1]+sex.summary[2])),4)*100`% . We have an almost equal proportion of male and female respondents.

To explore the problem of income disparity, let's now take a look at the average income of our respondents based on their gender category. 

#####Table 2: Average Income of Men and Women 
```{r, echo = FALSE, message = FALSE, warning = FALSE}
#Generating Income-Gender summary table (Get rid of NA row!!)
income.sex.summary <- tapply(nlsy.1$income.clean, INDEX = nlsy.1[c("gender")],FUN=mean, na.rm=TRUE)
income.sex.summary
```

As we can see from **Table 2**, the average income of men is *income.sex.summary[2] - income.sex.summary[1] = $ 14,892* more than women. To further understand the distribution of income between men and women, let's look at a box plot visualizing this difference. 

#####Plot 1
```{r, echo = FALSE, message = FALSE, warning = FALSE}
#Boxplot showing mean income by gender
income.gender.plot <- ggplot(data = subset(nlsy.1, !is.na(gender)), aes(x = gender, y = income.clean, fill = gender))
income.gender.plot + geom_boxplot(stat = "boxplot") + ylim(0,200000) + ggtitle("Income differences by Gender") + xlab("Gender") +
ylab("Income($)")
```

#####From the above plot, we have the following key takeaways. In addition to lower average income of women compared to men:

a. The  median income of female respondents is definitely much less compared to that of male respondents.
b. The lower quartile of women's income is below that of men.
c. The upper quartile of men's income is above that of women.
d. The interquartile range (IQR) of women's income is lower than that of men. 


At this point, we are certain that women are definitely earning less than men. But, it is important to test if this difference is statistically significant before we jump in to analyse factors contributing to this disparity. For this purpose we will conduct a t-test. 

##### T-test for Income and Gender
```{r, echo = FALSE, message = FALSE, warning = FALSE}
#T-test to check if the higher average income of men compared to women is statistically significant
income.t.test <- t.test(income ~ gender, data = nlsy.1)
income.t.test
```

From the above t-test results, we can see that the difference in income betweem men and women is statistically significant. With a p-value of 0, we can safely conclude that the difference in income between the two genders is not attributed to random chance or other sampling errors.

Now let's dive right in to see what are some factors contributing to this. 

###a) Race:

We have race data for all 11812 respondents in our subset. Let's take a look at the distribution of individuals across race categories.

#####Table 3: Number of respondents broken down by race categories
```{r, echo = FALSE, message = FALSE, warning = FALSE}
#About Race Data:
race.summary <- table(nlsy.1$race)
race.summary
```

From above we can see that the largest number of respondents i.e *`r race.summary[3]`* respondents are neither Black nor Hispanic. Let us now look at average income of men and women across these race categories. 

#####Table 4: Average Income of Men and Women across Race
```{r, echo = FALSE, message = FALSE, warning = FALSE}
#2 Generating income summary table at the Race-Gender level
income.race.summary <- tapply(nlsy.1$income.clean, INDEX = nlsy.1[c("race", "gender")],FUN = mean,na.rm=TRUE)
cbind(income.race.summary, Difference = income.race.summary[,2] - income.race.summary[,1])
```

Within every single race category, we can see that average income of women is lesser than that of men.The difference is largest among **Non-Black Non-Hispanic** individuals and the least among **Black** individuals. At a later point in this project we will investigate in greater detail the income and income gap differences between men and women within each race. Let's look at a more visual representation of the same. 

To further understand the distribution of income between men and women within each race category, let's look at a visual representation of this difference. 

#####Plot 2
```{r, echo = FALSE, message = FALSE, warning = FALSE}
#Boxplot showing income variation by race
income.race.plot <- ggplot(data = subset(nlsy.1, !is.na(race)), aes(x = race, y = income.clean, fill = gender))
income.race.plot + geom_boxplot(stat = "boxplot") + ylim(0,200000) + ggtitle("Income Differences by Race") + xlab("Race") + ylab("Income($)")
```

Similar to Plot 1, the above boxplot also indicates that not only is the median income of women lower than that of men, but so is the lower and upper quartile of women's income compared to men. I observed a very similar trend across **ALL** my variables of choice. 

Let's take a quick look at the boxplots visualizing how income varies between men and women among a few other variables that I've chosen as well - Industry, Foreign Language and Drug Use. 


###b) Industry:

#####Plot 3
```{r, echo = FALSE, message = FALSE, warning = FALSE}
#Boxplot showing mean income by industry
income.industry.plot <- ggplot(data = subset(nlsy.1, !is.na(industry)), aes(x = industry, y = income.clean, fill = gender))
income.industry.plot + geom_boxplot(stat = "boxplot") + ylim(0,200000) +
ggtitle("Income Differences by Industry") + xlab("Industry") + ylab("Income($)") +theme(axis.text.x = element_text(angle = 60, hjust = 1))
```

From this plot, we can see that the trend of lower income among women prevails except in the case of women in the Armed Forces (albeit the interquartile range is almost 0 for female income). Also, we see the largest difference in income for Agriculture, Finance and Tech Services. We do a more in-depth analysis of `industry` when we study the impact of top-coded values. 

###c) Place of Birth:

#####Plot 4
```{r, echo = FALSE, message = FALSE, warning = FALSE}
#Boxplot showing mean income by Place of birth
income.south.plot <- ggplot(data = subset(nlsy.1, !is.na(south)), aes(x = south, y = income.clean, fill = gender))
income.south.plot + geom_boxplot(stat = "boxplot") + ylim(0,200000) +
ggtitle("Income Differences by Place of Birth") + xlab("Place of Birth") + ylab("Income($)")
```

Again here, the trend of lower income among women continues across all categories of Place of Birth. The largest disparity seems to be among individuals who are from the North. We analyse the impact of `south` in greater detail in the **Findings** section of this project.

Overall, it is evident from our data summary that there is a serious case of income disparity between men and women and this prevails across a variety of factors as discussed above. However, what we are really interested in is **how serious** is this disparity. Is it statistically significant? Are we **confident** of our conclusions? Do we have sufficient conclusive proof to claim the impact of a specific variable on the gender-based income difference? These are some questions that we will explore through the remainder of this project. 

                                                  *************************************
                                                  
###2. Methodology:

Before I began exploring this dataset, I had to do **three** important things:

a. Deal with Missing Values
b. Deal with Topcoded Values
c. Create a subset to define a geographic boundary for my analysis

In this section, I will explain how I went about each of the above items. Then we will look at how I got to my main findings in this project. 

####**Missing Values:**

In this dataset, missing values came in the following categories:

a. **Non-interview(Coded -5):**  This includes respondents who did not participate at all in the survey that year. For 6 out of 8 variables that I chose, the number of non-participants was 0. So I didn't encounter -5 at all for those 6 variables. However I did have about **617** non-participants for `drug.use` and **5385** non-participants for `income`. Even though ~43% did not participate at all to provide their income and that's a huge percentage, there is very little that we can do about it. So, I just mapped -5s for both variables to NA.

b. **Valid Skips (Coded -4):** This includes respondents who did not answer a question as it was not applicable to them. These respondents are therefore not a part of the Universe. Again here, for 6 out of 8 variables, I did not have to encounter this problem at all as the number of valid skips were 0. However, there were **7** valid skips for `income` and **9894** valid skips for `foreign.lang`. Valid Skips constitute 78% of the respondents in case of Foreign Language which is huge! So, assuming that this happened because none of the options of languages spoken were applicable to them, I mapped the Valid Skips to a new factor level called **None**. However, for `income` since this number was only 7, I simply mapped it to NA as it barely affects the sample size.  

c. **Invalid Skips, Don't Know and Refusal (Coded -3,-2 and -1 respectively):** These are respondents who missed a question that they should've answered due to an incorrect flow in the survey, didn't know the answer or refused to respond to the question. The number of individuals in either of these categories were a very small number compared to the sample size. The highest number that I came across in this case was **146** respondents for the **Don't Know** in case of `income`. With respondents in these categories contributing to **<1%** of my sample size, I simply mapped them to NA. 



####**Topcoded Values:**
Being a publicly available dataset, top-coding helps protect the confidentiality of some responses. The Income varaible has been top-coded to be the average income of the **top 2%** earners in this dataset for this very reason. However, to ensure that this kind of averaging does not affect my analysis in anyway, I took the following approach:

1. **Create `income.clean`:** 

If we summarize the `income` variable we will find that the largest income value is USD 343,830 with 135 respondents in that bucket. Given that USD 343,830 is the average of the top 2% earners in our dataset, I created `income.clean` which maps 343830 to **NA**. For a cleaner analysis, I mapped USD 0 (which had 1634) to **NA** as well. We have 1634 respondents who reported USD 0 as their income. By mapping this to NA we further lose ~14% of our respodents. Unfortunately, this leaves us with a sample size of only  **`r sum(!is.na(nlsy.1$income.clean))`** respondents as opposed to **`r sum(!is.na(nlsy.1$income))`** individuals when we retain top-coded values. But this is still a fairly large sample size and we will use the `income. clean` variable for most of our analysis. 
 
2. **QQ Plot: Comparitive analysis of `income` and `income.clean` to check impact on analysis**

To further understand if removing top-coded values and 0 has an impact on our analysis, let's compare the QQ plots of `income` and `income.clean`. 

#####Plot 5: QQ plot of `income`
```{r, echo = FALSE, message = FALSE, warning = FALSE}
#QQ plot of income with top coded values
qqnorm(nlsy.1$income)
```

#####Plot 6: QQ plot of `income.clean`
```{r, echo = FALSE, message = FALSE, warning = FALSE}
#QQ plot of income without top code values
qqnorm(nlsy.1$income.clean)
```

From above, we can see that there's a peculiar trend among top-coded values which affects the normality of the `income` QQ plot. However, the QQ plot of `income.clean` is a perfectly normal light-tailed plot. 

The key takeaway here is that apart from the peculiarity among top-coded values, the rest of the income values are almost normally distributed for both `income` and `income.clean`. 

3. **Summary Tables: Comparitive analysis of `income` and `income.clean` to check impact on analysis**

However, the following summary tables help us see instances where excluding top coded values **can** make a big difference. Let's begin by looking at a comprehensive summary table of `race`. 

#####Table 5: Comapritive Analysis of `income` and `income.clean` by `race`

```{r, echo = FALSE, message = FALSE, warning = FALSE}
#Generating income summary table at the Race-Gender level
income.clean.race.summary <- tapply(nlsy.1$income.clean, INDEX = nlsy.1[c("race", "gender")],FUN = mean,na.rm=TRUE)

income.race.summary <- tapply(nlsy.1$income, INDEX = nlsy.1[c("race", "gender")],
                                  FUN = mean, na.rm=TRUE)

race.interim.summary <- cbind(income.clean.race.summary,
      NoTC.Diff = (income.clean.race.summary[,2] - income.clean.race.summary[,1]),
      TC.Diff = (income.race.summary[,2] - income.race.summary[,1]),
      NoTC.PercDiff = ((income.clean.race.summary[,2] - income.clean.race.summary[,1])/ 
        (income.clean.race.summary[,2])) *100,
      TC.PercDiff = ((income.race.summary[,2] - income.race.summary[,1])/ 
        (income.race.summary[,2])) *100)

race.final.summary <- cbind(race.interim.summary, 
      Difference = race.interim.summary [,6] - race.interim.summary[,5])

race.final.summary

```

From the above table we can see that there is almsot a **14%** difference between `income` with and without top-coded values amongst the **Non Black Non Hispanic Racial Cohort**. This is a pretty big difference. 
However, we can also observe that the absolute differences in income between men and women is much higher in case of income **with** top-coded values than without. This could be as a result of the high average income of the top 2% earners which could leading to skewing our analysis. 

Let's do a similar analysis with `industry`. 

#####Table 6: Comparitive Analysis of `income` and `income.clean` by `industry`

```{r, echo = FALSE, message = FALSE, warning = FALSE}
#Generating income summary table at the Industry-Gender level
income.clean.industry.summary <- tapply(nlsy.1$income.clean, INDEX = nlsy.1[c("industry", "gender")],FUN = mean,na.rm=TRUE)

income.industry.summary <- tapply(nlsy.1$income, INDEX = nlsy.1[c("industry", "gender")],
                                  FUN = mean, na.rm=TRUE)

industry.interim.summary <- cbind(income.clean.industry.summary,
      NoTC.Diff = (income.clean.race.summary[,2] - income.clean.race.summary[,1]),
      TC.Diff = (income.industry.summary[,2] - income.industry.summary[,1]),
      NoTC.PercDiff = ((income.clean.industry.summary[,2] - income.clean.industry.summary[,1])/ 
        (income.clean.industry.summary[,2])) *100,
      TC.PercDiff = ((income.industry.summary[,2] - income.industry.summary[,1])/ 
        (income.industry.summary[,2])) *100)

industry.final.summary <- cbind(industry.interim.summary, 
      Difference = industry.interim.summary [,6] - industry.interim.summary[,5])

industry.final.summary
```

Even here we observe a very high %Diff in incomes with and without top-coded values in case of **Financial Insurance, Accomodations & Food, Health Care and Retail Trade**. But similar to our observation in the case of `race`, we can see that the absolute differences are very high in case of income **with** top-coded values than without. Therefore, we can conclude for the moment that while excluding top-coded values will definitely have some impact, we are yet to determine if that impact is in fact significant. 

We will further speculate this difference with regressions in the **Findings** section of this project. 


####**Creating a Subset with only those born in the US**
To further strealmine my analysis, I created a subset of my dataset to include only those individuals who were born **in the US**. This reduces my population from `r nrow(nlsy.2)` to `r nrow(nlsy.1)` individuals.


####**Other Interesting Trends and Findings:**

As we observed earlier in the **Data Summary** section with `race`, `south`(Place of Birth) and `industry`, we can see that the average income of women is lower than that of men across other factors too. I decided to investigate this difference in greater depth with `drug.use` and `foreign.lang`.

Let's look at a more in-depth analysis of gender-based income difference across the various sub categories of `drug.use` and `foreign.lang`.


###a) Drug-Use:

#####Plot 7
```{r, echo = FALSE, message = FALSE, warning = FALSE}
#Boxplot showing mean income by drug use
income.druguse.plot <- ggplot(data = subset(nlsy.1, !is.na(drug.use)), aes(x = drug.use, y = income.clean, fill = gender))
income.druguse.plot + geom_boxplot(stat = "boxplot") + ylim(0,200000) +
ggtitle("Income Differences by Drug Use") + xlab("Drug Use") + ylab("Income($)") +theme(axis.text.x = element_text(angle = 60, hjust = 1))
```

For the above plot, we can see the median income of women is lower that of men across varying number of occassions of marijuana use. I performed a very similar analysis to the one above for `drug.use` using income both with and without top-coded values. 

#####Table7: Regresing Income on Gender and Foreign Language
```{r, echo = FALSE, message = FALSE, warning = FALSE}
#Linear Regression: Regressing income on gender and Drug-use (without top-coded values)
income.druguse.tc.lm <- lm(income.clean ~ gender + drug.use, data = nlsy.1)
kable(summary(income.druguse.tc.lm)$coef, digits = c(3, 3, 3, 4))
```

The baseline for this regressions is **Female** (for gender) and **Never Used**(for drug use). And the results in this case were not statistically significant either except for two cases:

**1. Drug-use: 10-39 occassions**

For this case, I observed that holding `gender` constant, a person consuming Marijuana between 10-39 occassions makes **$ 6387.53** more than a person who has never used Marijuana before! And this result is statistically significant at a p-value of 0.0001. 

It is also interesting to note that the general trend here (holding `gender` constant) indicates that the income of an individual who has used Marijuana **atleast once** and upto **999** times has a higher income than an individual who has never used it before. But the income difference is particulary the **highest** for a person who used it 10-39 times! 

Albeit for categories apart from 10-39 occassions, the results are **not statistically significant**. 

**2. Drug-use: 1000+ occassions**

Having noted the above, we can see that holding `gender` constant, the income of an individual who has used Marijuana at **1000+ occassions** is **$ 6125.14** lesser than that of an individual who has never used Marijuana before. This result is as expected to say that the income of a person who is almost habitually consuming Marijuana is **significantly** lesser than that of a person who has never consumed Marijuana before. This result is also statistically significant at a p-value of 0.0022. 


*Note: The results for the analysis of `drug.use` are very similar in terms of trends and statistical significance irrespective of using income with or without top-coded values.*


###b) Foreign Language:

#####Plot 8
```{r, echo = FALSE, message = FALSE, warning = FALSE}
#Boxplot showing mean income by foreign language
income.forlang.plot <- ggplot(data = subset(nlsy.1, !is.na(foreign.lang)), aes(x = foreign.lang, y = income.clean, fill = gender))
income.forlang.plot + geom_boxplot(stat = "boxplot") + ylim(0,200000) +
ggtitle("Income Differences by Foreign Language") + xlab("Foreign Language") + ylab("Income($)")
```

For the above plot, we can see that the the median income of women is lower than that of men for all categories except for those women who grew up in a household where **French** was spoken. For these women, the median income is **higher** than that of men. This was very interesting and unexpected as an outcome. To further investigate this anomaly, I ran the follwing regression where I regressed `income.clean` **(without top coded values)** on `gender` and `foreign.lang`:

#####Table 8: Regresing Income on Gender and Foreign Language
```{r, echo = FALSE, message = FALSE, warning = FALSE}
#Linear Regression: Regressing income on gender and Foreign Language(without topcoded values)
income.forlang.lm <- lm(income.clean ~ gender + foreign.lang, data = nlsy.1)
kable(summary(income.forlang.lm)$coef, digits = c(3, 3, 3, 4))
```

Our baseline in this regression is **Female** (for gender) and **None**(for foreign language). From the above results we have the following key takeaways:

1. The income of a female with no foreign langauge spoken during her childhood makes $ 39,458.421 which is our baseline.  

2.The difference in income betweeno a **female** with French-speaking childhood and **male** with a French-speaking chilhood is:

*(intercept + foreign.langFrench + genderMale)  - (intercept + foreign.langFrench)*

= *(39,458.421 + 3592.796 + 14,892.894) - (39,458.421 + 3592.796)*

= **$ 14,892.894**

3. But at p-value of 0.5501, this is **not** a statistically significant result.

4. We also observe that holding `gender` constant, a Spanish speaking individual makes $ 2431.43 **less** than an individual with no foreign language spoken during their childhood. However, at a p-value of 0.0744 this result too is **not** statistically significant. 

*Note: The results for the analysis of `foreign.lang` are very similar in terms of trends and statistical significance irrespective of using income with or without top-coded values.*


#####Conclusion for this section:
We can conclude that irrespective of using income with or without top-coded values, both **Foreign Language** and **Drug Use** are overall not statistically significant predictors of income differences between men and women. Which brings us to the next section of my analysis where I explore the effects of `race`, `south`(place of birth) and `marital.status` on gender-based income disparity. These are the variables that I've chosen to illustrate my main findings. 

                                          
                                                  *************************************
                                                  
###3. Findings:

This section will primarily cover factors that have a **statistically significant** impact in contributing to the gender-based income disparity.

###a) Race:

Let us begin by looking at a linear regression output of `income` vs `gender`, `race` and `south`(Place of Birth)

#####Table 9: Regresing Income on Gender, Race and Place of Birth
```{r, echo = FALSE, message = FALSE, warning = FALSE}
#Linear Regression: Regressing income on gender, race and place of birth
income.race.lm <- lm(income.clean ~ gender + race + south, data = nlsy.1)
kable(summary(income.race.lm)$coef, digits = c(3, 3, 3, 4))
```

Our baseline for this regression is **Female** (for gender), **Black** (for race) and **Not South**(for place of birth). From the above results we have the follwing key takeaways:

1. A black female who is not from the south has an income that is equal to the value at the intercept which is **$ 34,548.991**. This value is statistically significant at a p-vale of 0. 

2. Keeping `race` and `south`(place of birth) constant, the income of a male respondent is calculated as follows:

*intercept + genderMale*

= *34,581.991 + 14,781.752*

= **$ 49,363.74**

This value is statistically significant at a p-value of 0. 

3. Keeping `gender` and `south`(place of birth) constant, the income of a respondent who is Hispanic is calculated as follows:

*intercept + raceHispanic*

= *34,581.991 + 5821.813*

= **$ 40,403.8**

This value is statistically significant at a p-value of 0. The income can be calculated in a similar manner for Non Black Non Hispanic respondents as well. And that result is also statistically significant at a p-value of 0. 

4. Keeping `gender` and `race` constant, the income of a respondent who is born in the South is calculated as follows:

*intercept + southSouth*

= *34,581.991 - 4731.754*

= **$ 29,850.24**

This value is statistically significant at a p-value of 0. The income can be calculated in a similar manner for respondents born in a place other than the north and south as well. However, at a p-value of 0.1921 that result is **not** statistically significant.

5. Other calculations:

The income of a Hispanic male born in the South can be calculated as follows:

*intercept + genderMale + raceHispanic + southSouth*

= *34,581.991 + 14,781.752 + 5821.813 - 4731.75*

= **$ 50,453.81**

The income difference between a Female and Male both Black and born neither in the north nor south can be calculated as follows:

*(intercept + genderMale + southOther)  - (intercept + southOther)*

= *(34,581.991 + 14,781.752 - 4731.75) - (34,581.991 - 4731.75)*

= **$ 14,781.752** -> co-efficient of genderMale

*Note: The results for the above regression analysis of are very similar in terms of trends and statistical significance irrespective of using income with or without top-coded values.*

We dive a little deeper to see if race is infact a strong and statstically significant predictor of the gender-based income difference. To investigate this we perform an ANOVA test.

#####ANOVA: To test if race is statistically significant predictor gender-based income difference
```{r, echo = FALSE, message = FALSE, warning = FALSE}

#ANOVA: To assess if race is a statistically significant predictor of income by comparing with above regression
anova(update(income.race.lm, . ~ . - race), income.race.lm)
```

From the above results, we have further evidence to safely conclude that `race` is very strong predictor of gender-based income differences. To further complement our analysis, we now take a look at the diagnostic plots for our regression outcome `income.race.lm`. 



#####Plot 9: Diagnostic Plots for `income.race.lm`

```{r, echo = FALSE, message = FALSE, warning = FALSE}
plot(income.race.lm)
```

**a.Residual vs Fitted Plot:** From this plot, we can see that the trend line is very close to the 0 line with a small deviation in the center. This allows us to have a reasonable assumption that the relationship is a **linear** one.

**b.QQ Plot:** From this plot, we can observe that the residuals from the regression are almost perfectly normally distributed. This serves as reasonable evidence to say that our p-values for this regression are believable. 

**c.Scale-Location Plot:**  This plot is very similar to our Residual vs Fitted Plot. And here as well, the residuals appear to be randomly spread and we don't observe any discernible trends. 

**d.Residual vs Leverage Plot:** From this plot we observe that there are no strong outliers. This is also beacuse we've used `income.clean` for our analysis which does not contain 0s and top-coded values. Also, we don't observe any Cook's distance lines as we don't have any strong outliers.

Now that we have a robust analysis of the impact of `race`, let's look at how race can affect the **income gap** between men and women of the same racial cohort. 



#####Plot 10

```{r, echo = FALSE, message = FALSE, warning = FALSE}
#Plotting income gap between men and women within each race
income.gap.data <- ddply(nlsy.1, ~ race, summarize, 
                  income.gap = mean(income.clean[gender == "Male"], na.rm = TRUE) - 
                  mean(income.clean[gender == "Female"], na.rm = TRUE))

ggplot(data = subset(income.gap.data, !is.na(race)), aes(x = race, y = income.gap, fill = race)) + geom_bar(stat = "identity") +
xlab("Race") + ylab("Income gap($)") + ggtitle("Income gap between men and women by race") + 
guides(fill = FALSE) + theme(text = element_text(size=12))
```

From the above plot, we can see that the income disparity between men and women is largest among the **Non Black Non Hispanic** racial cohort and the least within the **Black** cohort. This kind of visual representation and in-depth analysis helps us understand that its not only important to see that race has an impact on income but also on the income gap within racial categories. This allows us to be able to more specifically pin point communities towards which public policy efforts need to be focused.


###b) Marital Status:
We now explore the next variable that has a big impact on the gender-based income disparity. 

#####Plot 11

```{r, echo = FALSE, message = FALSE, warning = FALSE}
#Boxplot showing mean income by Marital Status
income.marstat.plot <- ggplot(data = subset(nlsy.1, !is.na(marital.status)), aes(x = marital.status, y = income.clean, fill = gender))
income.marstat.plot + geom_boxplot(stat = "boxplot") + ylim(0,200000) +
ggtitle("Income Differences by Marital Status") + xlab("Marital Status") + ylab("Income($)")
```
From the above plot, we can see that median income for women is lower than that of men across all categories of `marital.status`. We will explore this further by looking at a linear regression output of `income` vs `gender` and `marital status`.

#####Table 10: Regresing Income on Gender and Marital Status

```{r, echo = FALSE, message = FALSE, warning = FALSE}
#Linear Regression: Regressing income on gender and marital status
income.marstat.lm <- lm(income.clean ~ gender + marital.status, data = nlsy.1)
kable(summary(income.marstat.lm)$coef, digits = c(3, 3, 3, 4))
```

Our baseline for this regression is **Female** (for gender) and **Never Married**(for marital status). From the above results we have the follwing key takeaways:

1. The income of a female who has never been married is the value at the intercept equal to **$ 40,190.32**. This value is statistically significant at a p-vale of 0. 

2. Keeping `marital.status` constant, the income of a male respondent is calculated as follows:

*intercept + genderMale*

= *40,190.31 + 14,241.473*

= **$ 54,431.78**

This value is statistically significant at a p-value of 0. 

3. Keeping `gender` constant, the income of a respondent who is Married is calculated as follows:

*intercept + marital.statusMarried*

= *40,190.31 - 5300.275*

= **$ 34,890.03 **

This value is statistically significant at a p-value of 0.0026. The income can be calculated in a similar manner for Divorced, Seperated and Widowed respondents as well to be **$ 29,269.81**, **$ 24,513.59** and **$ 30,000 **  respectively. But **none** of these results are statistically significant.  


4. Other calculations:

The income of a Seperated Female can be calculated as follows:
*intercept + marital.statusSeperated*

= *40,190.31 -15,676.222*

= **$ 24,514.09**

The income of a Divorced Male can be calculated as follows:

*intercept + genderMale + marital.statusDivorced*

= *40,190.31 + 14,241.473 -10,920.505*

= **$ 43,511.28**

The income difference between a Female and Male both Married can be calculated as follows:

*(intercept + genderMale + marital.statusMarried)  - (intercept + marital.statusMarried)*

= *(40,190.31 + 14,241.473 - 5300.275 ) - (40,190.31 - 5300.275)*

= *14,241.473* -> co-efficient of genderMale

**Important Note:** Again, it is important to note that the regression was run for income without top-coded values. But the analysis, trends and results obtained are in no way impacted if we use income with top-coded values.


To further investigate the **income gap** within each category of `marital.status`, we will look at a regression with interaction terms between `gender` and `marital.status`.

#####Table 11: Regresing Income on Gender and Marital Status (with interaction)
```{r, echo = FALSE, message = FALSE, warning = FALSE}
#Linear Regression: Regressing income on gender and Marital Status with interaction
income.marstat.interaction <- lm(income.clean ~ gender + marital.status + gender*marital.status, data = nlsy.1)
kable(summary(income.marstat.interaction)$coef, digits = c(3, 3, 3, 4))

```

Our baseline for this regression is **Female** (for gender) and **Never Married**(for marital status). From the above results we have the following key takeaways:

1. Income difference between a divorced and never-married male can be calculated as follows:

*(intercept +  genderMale + marital.statusDivorced + genderMale:marital.statusDivorced) - (intercept +  genderMale)*

*( 40,190.31 + 14,177.406 -10,920.505 - 2234.549) - (40,190.31 + 14,177.406)*

**$ -13155.05**

2. Relative to a never married female:
Married women income = **$ 34,431.2**

Formula : *intercept + marital.statusMarried*

Divorced women income = **$ 29,524.18**

Formula : *intercept + marital.statusDivorced*

Seperated women income = **$ 26,370.46**

Formula : *intercept + marital.statusSeperated*

Widowed women income = **$ 29,967.04**

Formula : *intercept + marital.statusWidowed*

3. Relative to a never married male:
Married men income = **$ 50380.79**

Formula : *intercept + genderMale + marital.statusMarried + genderMale:marital.statusMarried*

Divorced men income = **$ 41467.03**

Formula : *intercept + genderMale + marital.statusDivorced + genderMale:marital.statusDivorced*

Seperated men income = **$ 33682.59**

Formula : *intercept + genderMale + marital.statusSeperated + genderMale:marital.statusSeperated*


As a final step to ensure that `marital.status` is in fact a statistically significant predictor of the gender-based income disparity, we do the ANOVA test.

#####ANOVA: To test if marital status is statistically significant predictor gender-based income difference
```{r, echo = FALSE, message = FALSE, warning = FALSE}

#ANOVA: To assess if marital status is a statistically significant predictor of income by comparing with above regression
anova(update(income.marstat.interaction, . ~ . - marital.status*gender), income.marstat.interaction)
```

From the results, it is evident that `marital status` is a strong predictor of gender-based income difference. At a p-value of 0, this result is statistically significant. 

                                                  *************************************
                                                  
###4. Discussion:

The major takeaway through this project is that **Race**, **Place of Birth** and **Marital Status** are all strong predictors of the income disparity between men and women. While there were some interesting takeaways with `drug.use` and `foreign.lang` variables, the results were not statistivcally significant. 

Throughout my analysis, I've used an alpha level of **0.05**. Therefore, I can say than I am **95% confident** of my results especially w.r.t to the analysis conducted in the **Findings** section of this report. However there are also some potential drawabacks:

1. For the purpose of not letting outlier data impact my analysis I removed 0s and top-coded values from my Income variable. I suspect that this could have an impact on the **external validity** of my analysis. 

2. Despite being a comprehensive dataset with several thousand respondents and multiple variables, I suspect the generalizability of my findings. I would like to run a similar analysis for NLSY data for subsequent years to make conclusions surrounding the generalizability of my findings. Only after that will I be confident enough to share my findings with policy makers.

But for the most part I do believe that there is sufficent conclusive proof to indicate without doubt what factors are responsible for income differences between men and women and what are not. If anything, this analysis can prove to be a robust starting point for conversations surrounding gender-based income disparity and further analysis. 

                                                  *************************************
                                                                  The End


